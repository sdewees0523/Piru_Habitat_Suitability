---
title: "Piru Progress"
author: "Shane Dewees"
date: "12/15/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(here)
library(lubridate)
library(sf)
library(raster)
library(tidyverse)
library(stats)
library(jtools)
library(ggparty)
library(partykit)
library(randomForest)
```

```{r}
planting <- read.csv(here("data", "planting.csv")) %>% 
  rename("plot_number" = "ID")
watering <- read.csv(here("data","watering.csv"))%>% 
  rename("plot_number" = "ID")
measuring <- read.csv(here("data", "measuring.csv"))%>% 
  rename("plot_number" = "ID")
measuring_2 <- read.csv(here("data", "measuring_2.csv"))%>% 
  rename("plot_number" = "ID")
measuring_3 <- read.csv(here("data", "measuring_3.csv"))%>% 
  rename("plot_number" = "ID")

# Table of only plants alive by March 2020
planting_survival <- planting %>% 
  dplyr::select(plot_number, Plant, Height, Date.Planted) %>% 
  mutate(Plant = str_replace_all(string = Plant, pattern = "(White + Pink)", replacement = "")) %>% 
  mutate(Plant = case_when(Plant == "ENCA (Pink)" ~ "ENCA",
                           Plant == "CEOL (Orange)" ~ "CEOL",
                           Plant == "HEWH (White)" ~ "HEWH",
                           Plant == "SAME (Orange + Pink)" ~ "SAME",
                           Plant == "SANI (Orange + Yellow)" ~ "SANI",
                           Plant == "RHOV (White + Pink)" ~ "RHOV",
                           Plant == "SAAP (White + Green)" ~ "SAAP",
                           Plant == "MALA (White + Yellow)" ~ "MALA",
                           Plant == "HEAR" ~ "HEAR",
                           Plant == "ADFA (Orange + Green)" ~ "ADFA",
                           Plant == "RHOV SAAP (White + Pink)" ~ "SAAP",
                           Plant == "ENCA CEOL (Pink)" ~ "CEOL", 
                           Plant == "HEWH (White) RHOV" ~ "RHOV",
                           Plant == "NO PLANT" ~ "No Plant")) %>% 
  filter(Plant != "No Plant", Height != "") %>% 
  mutate(date = my(0320),
         alive = 1) %>% 
  dplyr::select(plot_number,Plant, alive, date)

# Table of plant survival as of May 2020
watering_survival <- watering %>% 
  mutate(Plant = case_when(Plant == "ENCA (Pink)" ~ "ENCA",
                           Plant == "CEOL (Orange)" ~ "CEOL",
                           Plant == "HEWH (White)" ~ "HEWH",
                           Plant == "SAME (Orange + Pink)" ~ "SAME",
                           Plant == "SANI (Orange + Yellow)" ~ "SANI",
                           Plant == "RHOV (White + Pink)" ~ "RHOV",
                           Plant == "SANI (Orange + Yellow) CEOL" ~ "CEOL",
                           Plant == "SAAP (White + Green)" ~ "SAAP",
                           Plant == "MALA (White + Yellow)" ~ "MALA",
                           Plant == "SANI  MALA" ~ "MALA",
                           Plant == "HEAR" ~ "HEAR",
                           Plant == "ADFA (Orange + Green)" ~ "ADFA",
                           Plant == "HEWH (White) ENCA" ~ "ENCA",
                           Plant == "ADFA" ~ "ADFA",
                           Plant == "SANI" ~ "SANI",
                           Plant == "SAME" ~ "SAME",
                           Plant == "SANI " ~ "SANI",
                           Plant == "" ~"No plant")) %>% 
  filter(Plant != "No plant") %>% 
  mutate(alive = case_when(Alive.1 == "y" ~ 1,
                           Alive.1 == "Y" ~ 1,
                           Alive.1 == "n" ~ 0,
                           Alive.1 == "np" ~ 0,
                           Alive.1 == "" ~ 0,
                           Alive.1 == "N" ~ 0,
                           Alive.1 == "NP" ~ 0),
         date = my(0520)) %>% 
  dplyr::select(plot_number,Plant, alive, date)

# Table of plant survival as of July 2020
measuring_survival <- measuring %>% 
  mutate(Plant = case_when(Plant == "ENCA (Pink)" ~ "ENCA",
                           Plant == "CEOL (Orange)" ~ "CEOL",
                           Plant == "HEWH (White)" ~ "HEWH",
                           Plant == "SAME (Orange + Pink)" ~ "SAME",
                           Plant == "SANI (Orange + Yellow)" ~ "SANI", 
                           Plant == "RHOV (White + Pink)" ~ "RHOV",
                           Plant == "SAAP (White + Green)" ~ "SAAP",
                           Plant == "MALA (White + Yellow)" ~ "MALA",
                           Plant == "ADFA (Orange + Green)" ~ "ADFA",
                           Plant == "HEAR" ~ "HEAR",
                           Plant == "ENCA CEOL (Pink)" ~ "CEOL",
                           Plant == "NO PLANT" ~ "No Plant",
                           Plant == "HEWH (White) RHOV" ~ "RHOV",
                           Plant == "HEWH" ~ "HEWH"),
         alive = case_when(Height > 0 ~ 1),
         date = my(0720)) %>% 
  filter(Plant != "No Plant") %>% 
  dplyr::select(plot_number,Plant, alive, date)

# Table of plant survival as of November 2020
measuring_survival_2 <- measuring_2 %>% 
  mutate(Plant = str_replace(Plant, " ", ""),
         alive = case_when(Height > 0 ~ 1,
                           TRUE ~ 0),
         date = my(1120)) %>% 
  filter(Plant != "") %>% 
  dplyr::select(plot_number,Plant, alive, date)

# Table of plant survival as of December 2021
measuring_survival_3 <- measuring_3 %>% 
  mutate(alive = case_when(Height > 0 ~ 1),
        date = my(1221)) %>% 
  filter(Plant != "") %>% 
  dplyr::select(plot_number,Plant, alive, date)

# Table of percent each species alive at all dates
survival <- rbind(planting_survival,watering_survival,measuring_survival, measuring_survival_2, measuring_survival_3) %>% 
  group_by(Plant, date) %>% 
  summarise(alive = sum(alive, na.rm = TRUE)) %>% 
  mutate(alive_percent = case_when(Plant == "ADFA" ~ alive/148 * 100,
                                   Plant == "CEOL" ~ alive/250 * 100,
                                   Plant == "ENCA" ~ alive/204 * 100,
                                   Plant == "HEAR" ~ alive/121 * 100,
                                   Plant == "HEWH" ~ alive/247 * 100,
                                   Plant == "MALA" ~ alive/89 * 100,
                                   Plant == "RHOV" ~ alive/195 * 100,
                                   Plant == "SAAP" ~ alive/95 * 100,
                                   Plant == "SAME" ~ alive/130 * 100, 
                                   Plant == "SANI" ~ alive/160 * 100),
         Plant = case_when(Plant == "ADFA" ~ "Adenostoma fasciculatum",
                                   Plant == "CEOL" ~ "Ceanothus oliganthus",
                                   Plant == "ENCA" ~ "Encelia californica",
                                   Plant == "HEAR" ~ "Heteromeles arbutifolia",
                                   Plant == "HEWH" ~ "Hesperoyucca whipplei",
                                   Plant == "MALA" ~ "Malosma laurina",
                                   Plant == "RHOV" ~ "Rhus ovata",
                                   Plant == "SAAP" ~ "Salvia apiana",
                                   Plant == "SAME" ~ "Salvia mellifera", 
                                   Plant == "SANI" ~ "Sambucus nigra"))

# Table of percent alive for all species combined
survival_total <- survival %>% 
  group_by(date) %>% 
  summarise(alive = sum(alive))

ggplot(survival, aes(date, alive_percent)) +
  geom_point() +
  geom_line () +
  facet_wrap(~Plant, nrow = 5, ncol = 2) +
  labs(y = "Percent Alive") +
  theme_classic()

ggplot(survival, aes(date, alive)) +
  geom_point() +
  geom_line () +
  facet_wrap(~Plant, nrow = 5, ncol = 2) +
  theme_classic()

ggplot(survival_total, aes(date, alive)) +
  geom_point() +
  geom_line() +
  labs(y = "Number plants alive") +
  theme_classic()
  
```

## Cleaning and initial visualization of growth data

```{r}
# Growth data as of March 2020
planting_growth <- planting %>% 
  mutate(Plant = str_replace_all(string = Plant, pattern = "(White + Pink)", replacement = "")) %>% 
  mutate(Plant = case_when(Plant == "ENCA (Pink)" ~ "ENCA",
                           Plant == "CEOL (Orange)" ~ "CEOL",
                           Plant == "HEWH (White)" ~ "HEWH",
                           Plant == "SAME (Orange + Pink)" ~ "SAME",
                           Plant == "SANI (Orange + Yellow)" ~ "SANI",
                           Plant == "RHOV (White + Pink)" ~ "RHOV",
                           Plant == "SAAP (White + Green)" ~ "SAAP",
                           Plant == "MALA (White + Yellow)" ~ "MALA",
                           Plant == "HEAR" ~ "HEAR",
                           Plant == "ADFA (Orange + Green)" ~ "ADFA",
                           Plant == "RHOV SAAP (White + Pink)" ~ "SAAP",
                           Plant == "ENCA CEOL (Pink)" ~ "CEOL", 
                           Plant == "HEWH (White) RHOV" ~ "RHOV",
                           Plant == "NO PLANT" ~ "No Plant")) %>% 
  filter(Plant != "No Plant", Height != "") %>% 
  mutate(date = my(0320)) %>% 
  dplyr::select(plot_number,Plant, Height, Width.1, Width.2, Stem.Diameter, date)

# Growth data as of July 2020
measuring_growth <- measuring %>% 
  mutate(Plant = case_when(Plant == "ENCA (Pink)" ~ "ENCA",
                           Plant == "CEOL (Orange)" ~ "CEOL",
                           Plant == "HEWH (White)" ~ "HEWH",
                           Plant == "SAME (Orange + Pink)" ~ "SAME",
                           Plant == "SANI (Orange + Yellow)" ~ "SANI", 
                           Plant == "RHOV (White + Pink)" ~ "RHOV",
                           Plant == "SAAP (White + Green)" ~ "SAAP",
                           Plant == "MALA (White + Yellow)" ~ "MALA",
                           Plant == "ADFA (Orange + Green)" ~ "ADFA",
                           Plant == "HEAR" ~ "HEAR",
                           Plant == "ENCA CEOL (Pink)" ~ "CEOL",
                           Plant == "NO PLANT" ~ "No Plant",
                           Plant == "HEWH (White) RHOV" ~ "RHOV",
                           Plant == "HEWH" ~ "HEWH"),
         date = my(0720)) %>% 
  filter(Plant != "No Plant") %>% 
  dplyr::select(plot_number,Plant, Height, Width.1, Width.2, Stem.Diameter, date)

# Growth data as of November 2020
measuring_growth_2 <- measuring_2 %>% 
  mutate(Plant = str_replace(Plant, " ", ""),
         date = my(1120)) %>% 
  filter(Plant != "") %>% 
  dplyr::select(plot_number,Plant, Height, Width.1, Width.2, Stem.Diameter, date)

# Growth data as of December 2021
measuring_growth_3 <- measuring_3 %>% 
  mutate(date = my(1221)) %>% 
  filter(Plant != "") %>% 
  dplyr::select(plot_number,Plant, Height, Width.1, Width.2, Stem.Diameter, date)

# Growth data grouped by species for all dates
growth <- rbind(planting_growth, measuring_growth, measuring_growth_2, measuring_growth_3) %>% 
  mutate(Height = as.numeric(Height),
         Width.1 = as.numeric(Width.1),
         Width.2 = as.numeric(Width.2),
         Stem.Diameter = as.numeric(Stem.Diameter)) %>% 
  group_by(Plant, date) %>% 
  summarise(mean_height = mean(Height, na.rm = TRUE),
            sd_height = sd(Height, na.rm = TRUE),
            mean_width_1 = mean(Width.1, na.rm = TRUE),
            sd_width_1 = sd(Width.1, na.rm = TRUE),
            mean_width_2 = mean(Width.2, na.rm = TRUE),
            sd_width_2 = sd(Width.2, na.rm = TRUE),
            mean_stem = mean(Stem.Diameter, na.rm = TRUE),
            sd_stem = sd(Stem.Diameter, na.rm = TRUE))

ggplot(growth, aes(date, mean_height)) + 
  geom_point()+
  geom_errorbar(aes(ymin = mean_height - sd_height, ymax = mean_height + sd_height), width = 0.2) +
  geom_line()+
  labs(y = "Stem Height (cm)") +
  facet_wrap(~Plant, nrow = 5, ncol = 2) +
  theme_classic()

ggplot(growth, aes(date, mean_width_1)) + 
  geom_point()+
  geom_errorbar(aes(ymin = mean_width_1 - sd_width_1, ymax = mean_width_1 + sd_width_1), width = 0.2) +
  geom_line()+
  labs(y = "Plant Width (cm)") +
  facet_wrap(~Plant, nrow = 5, ncol = 2) +
  theme_classic()

ggplot(growth, aes(date, mean_stem)) + 
  geom_point()+
  geom_errorbar(aes(ymin = mean_stem - sd_stem, ymax = mean_stem + sd_stem), width = 0.2) +
  geom_line()+
  labs(y = "Stem Diameter (cm)") +
  facet_wrap(~Plant, nrow = 5, ncol = 2) +
  theme_classic()
```

## Looking at survival without gopher kill 
  - unintuitably labelled gopher

```{r}
# Survival in May 2020
watering_gopher <- watering %>% 
  dplyr::select(plot_number, Watering.2.Date, Alive.1, Notes.1) %>% 
  rename("watering_date" = "Watering.2.Date",
         "watering_alive" = "Alive.1", 
         "watering_notes" = "Notes.1") 

# Growth & survival by July 2020 (gophers incl.)
measuring_gopher <- measuring %>% 
  dplyr::select(!Plant) %>% 
  rename("measuring_height" = "Height",
         "measuring_width_1" = "Width.1",
         "measuring_width_2" = "Width.2",
         "measuring_stem_diameter" = "Stem.Diameter",
         "measuring_date" = "Date.Measured",
         "measuring_notes" = "Notes")

# Growth & survival by November 2020 (gophers incl.)
measuring_gopher_2 <- measuring_2 %>% 
  dplyr::select(!Plant) %>%
  rename("measuring_2_height" = "Height",
         "measuring_2_width_1" = "Width.1",
         "measuring_2_width_2" = "Width.2",
         "measuring_2_stem_diameter" = "Stem.Diameter",
         "measuring_2_date" = "Date.Measured",
         "measuring_2_notes" = "Notes")

# Growth & survival by December 2021 (gophers incl.)
measuring_gopher_3 <- measuring_3 %>% 
  dplyr::select(!Plant) %>%
  rename("measuring_3_height" = "Height",
         "measuring_3_width_1" = "Width.1",
         "measuring_3_width_2" = "Width.2",
         "measuring_3_stem_diameter" = "Stem.Diameter",
         "measuring_3_date" = "Date.Measured",
         "measuring_3_notes" = "Notes")

# Joined table of growth/survival with all dates, gophers excluded
survival_gopher <- right_join(planting, watering_gopher, by = "plot_number") %>% 
  right_join(measuring_gopher, by = "plot_number") %>% 
  right_join(measuring_gopher_2, by = "plot_number") %>% 
  right_join(measuring_gopher_3, by = "plot_number") %>%  
  filter(watering_notes != "gopher", 
         watering_notes != "gopher activity", 
         watering_notes != "GOPHER", 
         watering_notes != "GOPHER ACTIVITY", 
         watering_notes != "5/15 np") %>% 
  filter(measuring_notes != "np", 
         measuring_notes != "np, g", 
         measuring_notes != "np, buried", 
         measuring_notes != "g.a.",
         measuring_notes != "dead, g.a.", 
         measuring_notes != "np, g.a.", 
         measuring_notes != "dead, g", 
         measuring_notes != "np, g (no coin catch#2)", 
         measuring_notes != "np,g",
         measuring_notes!= "herbivorized, g.a.") %>% 
  filter(measuring_2_notes != "NP", 
         measuring_2_notes != "MISSING", 
         measuring_2_notes != "NP ", 
         measuring_2_notes != "GOPHER", 
         measuring_2_notes != "NP? NO TAG", 
         measuring_2_notes != "MISSNG") %>%
  filter(measuring_3_notes != "NP")

planting_survival_gopher <- survival_gopher %>% 
  dplyr::select(plot_number,Plant, Height, Date.Planted) %>% 
  mutate(Plant = str_replace_all(string = Plant, pattern = "(White + Pink)", replacement = "")) %>% 
  mutate(Plant = case_when(Plant == "ENCA (Pink)" ~ "ENCA",
                           Plant == "CEOL (Orange)" ~ "CEOL",
                           Plant == "HEWH (White)" ~ "HEWH",
                           Plant == "SAME (Orange + Pink)" ~ "SAME",
                           Plant == "SANI (Orange + Yellow)" ~ "SANI",
                           Plant == "RHOV (White + Pink)" ~ "RHOV",
                           Plant == "SAAP (White + Green)" ~ "SAAP",
                           Plant == "MALA (White + Yellow)" ~ "MALA",
                           Plant == "HEAR" ~ "HEAR",
                           Plant == "ADFA (Orange + Green)" ~ "ADFA",
                           Plant == "RHOV SAAP (White + Pink)" ~ "SAAP",
                           Plant == "ENCA CEOL (Pink)" ~ "CEOL", 
                           Plant == "HEWH (White) RHOV" ~ "RHOV",
                           Plant == "NO PLANT" ~ "No Plant")) %>% 
  filter(Plant != "No Plant", Height != "") %>% 
  mutate(date = my(0320),
         alive = 1) %>% 
  dplyr::select(plot_number,Plant, alive, date)

watering_survival_gopher <- survival_gopher %>%
  dplyr::select(plot_number,Plant, watering_alive, watering_date) %>% 
  mutate(Plant = case_when(Plant == "ENCA (Pink)" ~ "ENCA",
                           Plant == "CEOL (Orange)" ~ "CEOL",
                           Plant == "HEWH (White)" ~ "HEWH",
                           Plant == "SAME (Orange + Pink)" ~ "SAME",
                           Plant == "SANI (Orange + Yellow)" ~ "SANI",
                           Plant == "RHOV (White + Pink)" ~ "RHOV",
                           Plant == "SANI (Orange + Yellow) CEOL" ~ "CEOL",
                           Plant == "SAAP (White + Green)" ~ "SAAP",
                           Plant == "MALA (White + Yellow)" ~ "MALA",
                           Plant == "SANI  MALA" ~ "MALA",
                           Plant == "HEAR" ~ "HEAR",
                           Plant == "ADFA (Orange + Green)" ~ "ADFA",
                           Plant == "HEWH (White) ENCA" ~ "ENCA",
                           Plant == "ADFA" ~ "ADFA",
                           Plant == "SANI" ~ "SANI",
                           Plant == "SAME" ~ "SAME",
                           Plant == "SANI " ~ "SANI",
                           Plant == "" ~"No plant")) %>% 
  filter(Plant != "No plant") %>% 
  mutate(alive = case_when(watering_alive == "y" ~ 1,
                           watering_alive == "Y" ~ 1,
                           watering_alive == "n" ~ 0,
                           watering_alive == "np" ~ 0,
                           watering_alive == "" ~ 0,
                           watering_alive == "N" ~ 0,
                           watering_alive == "NP" ~ 0),
         date = my(0520)) %>% 
  dplyr::select(plot_number,Plant, alive, date)

measuring_survival_gopher <- survival_gopher %>% 
  dplyr::select(plot_number,Plant, measuring_height, measuring_date) %>% 
  mutate(Plant = case_when(Plant == "ENCA (Pink)" ~ "ENCA",
                           Plant == "CEOL (Orange)" ~ "CEOL",
                           Plant == "HEWH (White)" ~ "HEWH",
                           Plant == "SAME (Orange + Pink)" ~ "SAME",
                           Plant == "SANI (Orange + Yellow)" ~ "SANI", 
                           Plant == "RHOV (White + Pink)" ~ "RHOV",
                           Plant == "SAAP (White + Green)" ~ "SAAP",
                           Plant == "MALA (White + Yellow)" ~ "MALA",
                           Plant == "ADFA (Orange + Green)" ~ "ADFA",
                           Plant == "HEAR" ~ "HEAR",
                           Plant == "ENCA CEOL (Pink)" ~ "CEOL",
                           Plant == "NO PLANT" ~ "No Plant",
                           Plant == "HEWH (White) RHOV" ~ "RHOV",
                           Plant == "HEWH" ~ "HEWH"),
         alive = case_when(measuring_height > 0 ~ 1, 
                           TRUE ~0),
         date = my(0720)) %>% 
  filter(Plant != "No Plant") %>% 
  dplyr::select(plot_number,Plant, alive, date)

measuring_survival_gopher_2 <- survival_gopher %>% 
  dplyr::select(plot_number,Plant, measuring_2_height, measuring_2_date) %>% 
  mutate(Plant = str_replace(Plant, " ", ""),
         Plant = case_when(Plant == "ENCA(Pink)" ~ "ENCA",
                           Plant == "CEOL(Orange)" ~ "CEOL",
                           Plant == "HEWH(White)" ~ "HEWH",
                           Plant == "SAME(Orange + Pink)" ~ "SAME",
                           Plant == "SANI(Orange + Yellow)" ~ "SANI", 
                           Plant == "RHOV(White + Pink)" ~ "RHOV",
                           Plant == "SAAP(White + Green)" ~ "SAAP",
                           Plant == "MALA(White + Yellow)" ~ "MALA",
                           Plant == "ADFA(Orange + Green)" ~ "ADFA",
                           Plant == "HEAR" ~ "HEAR",
                           Plant == "ENCACEOL (Pink)" ~ "CEOL",
                           Plant == "NOPLANT" ~ "No Plant",
                           Plant == "HEWH(White) RHOV" ~ "RHOV",
                           Plant == "HEWH" ~ "HEWH",
                           TRUE ~ Plant),
         alive = case_when(measuring_2_height > 0 ~ 1,
                           TRUE ~ 0),
         date = my(1120)) %>% 
  filter(Plant != "") %>% 
  dplyr::select(plot_number,Plant, alive, date)

measuring_survival_gopher_3 <- survival_gopher %>% 
  dplyr::select(plot_number,Plant, measuring_3_height, measuring_3_date) %>% 
  mutate(Plant = case_when(Plant == "ENCA (Pink)" ~ "ENCA",
                           Plant == "CEOL (Orange)" ~ "CEOL",
                           Plant == "HEWH (White)" ~ "HEWH",
                           Plant == "SAME (Orange + Pink)" ~ "SAME",
                           Plant == "SANI (Orange + Yellow)" ~ "SANI", 
                           Plant == "RHOV (White + Pink)" ~ "RHOV",
                           Plant == "SAAP (White + Green)" ~ "SAAP",
                           Plant == "MALA (White + Yellow)" ~ "MALA",
                           Plant == "ADFA (Orange + Green)" ~ "ADFA",
                           Plant == "HEAR" ~ "HEAR",
                           Plant == "ENCA CEOL (Pink)" ~ "CEOL",
                           Plant == "NO PLANT" ~ "No Plant",
                           Plant == "HEWH (White) RHOV" ~ "RHOV",
                           Plant == "HEWH" ~ "HEWH"),
         alive = case_when(measuring_3_height > 0 ~ 1, 
                           TRUE ~ 0),
        date = my(1221)) %>% 
  filter(Plant != "") %>% 
  dplyr::select(plot_number,Plant, alive, date)

survival_gopher_clean <- rbind(planting_survival_gopher,
                  watering_survival_gopher,
                  measuring_survival_gopher, 
                  measuring_survival_gopher_2, 
                  measuring_survival_gopher_3) %>% 
  group_by(Plant, date) %>% 
  summarise(alive = sum(alive, na.rm = TRUE)) %>% 
  ungroup() %>% 
  filter(Plant != "No Plant") %>% 
  mutate(alive_percent = case_when(Plant == "ADFA" ~ alive/118 * 100,
                                   Plant == "CEOL" ~ alive/97 * 100,
                                   Plant == "ENCA" ~ alive/83 * 100,
                                   Plant == "HEAR" ~ alive/61 * 100,
                                   Plant == "HEWH" ~ alive/80 * 100,
                                   Plant == "MALA" ~ alive/43 * 100,
                                   Plant == "RHOV" ~ alive/75 * 100,
                                   Plant == "SAAP" ~ alive/45 * 100,
                                   Plant == "SAME" ~ alive/48 * 100, 
                                   Plant == "SANI" ~ alive/62 * 100),
         Plant = case_when(Plant == "ADFA" ~ "Adenostoma fasciculatum",
                                   Plant == "CEOL" ~ "Ceanothus oliganthus",
                                   Plant == "ENCA" ~ "Encelia californica",
                                   Plant == "HEAR" ~ "Heteromeles arbutifolia",
                                   Plant == "HEWH" ~ "Hesperoyucca whipplei",
                                   Plant == "MALA" ~ "Malosma laurina",
                                   Plant == "RHOV" ~ "Rhus ovata",
                                   Plant == "SAAP" ~ "Salvia apiana",
                                   Plant == "SAME" ~ "Salvia mellifera", 
                                   Plant == "SANI" ~ "Sambucus nigra"))

survival_gopher_total <- survival_gopher_clean %>% 
  group_by(date) %>% 
  summarise(alive = sum(alive))

ggplot(survival_gopher_clean, aes(date, alive_percent)) +
  geom_point() +
  geom_line () +
  facet_wrap(~Plant, nrow = 5, ncol = 2) +
  labs(y = "Percent Alive") +
  theme_classic()

ggplot(survival, aes(date, alive)) +
  geom_point() +
  geom_line () +
  facet_wrap(~Plant, nrow = 5, ncol = 2) +
  theme_classic()

ggplot(survival_total, aes(date, alive)) +
  geom_point() +
  geom_line() +
  labs(y = "Number plants alive") +
  theme_classic()
```



## Reading in gps points and topgraphy data


```{r}
plots <- st_read(here("data", "plot_gps_points.shp")) %>% 
  rename("plot_number" = "plt_nmb")
elevation <- raster(here("data", "elevation.tif"))
aspect <- raster(here("data", "aspect.tif"))
aspect <- cos((aspect * pi/180) - (225 * pi/180))
slope <- raster(here("data", "slope.tif"))
solar_radiation <- brick(here("data", "sol_rad.tif"))
diurnal_heat <- raster(here("data", "diurnal_heat.tif"))
heat_load <- raster(here("data", "heat_load_index.tif"))
hierarchical_slope_position <- raster(here("data", "hierarchical_slope_position.tif"))
integrated_moisture <- raster(here("data", "integrated_moisture_index.tif"))
ruggedness_vector <- raster(here("data", "ruggedness_vector.tif"))
sol_rad_aspect <- raster(here("data", "sol_rad_aspect.tif"))
terrain_roughness <- raster(here("data", "terrain_roughness.tif"))
terrain_ruggedness <- raster(here("data", "terrain_ruggedness.tif"))
terrain_texture <- raster(here("data", "terrain_texture.tif"))
topographic_position <- raster(here("data", "topographic_position.tif"))
```


## Extracting topographic data to plot points

```{r}
plots_topography <- plots %>% 
  mutate(elevation = raster::extract(elevation, plots),
         aspect = raster::extract(aspect, plots),
         slope = raster::extract(slope, plots),
         summer_solar_radiation = raster::extract(solar_radiation[[3]], plots),
         spring_solar_radiation = raster::extract(solar_radiation[[2]], plots),
         winter_solar_radiation = raster::extract(solar_radiation[[1]], plots),
         diurnal_heat = raster::extract(diurnal_heat, plots),
         heat_load = raster::extract(heat_load, plots),
         hierarchical_slope_position = raster::extract(hierarchical_slope_position, plots), 
         integrated_moisture = raster::extract(integrated_moisture, plots),
         ruggedness_vector = raster::extract(ruggedness_vector, plots),
         sol_rad_aspect = raster::extract(sol_rad_aspect, plots),
         terrain_ruggedness = raster::extract(terrain_ruggedness, plots),
         terrain_roughness = raster::extract(terrain_roughness, plots),
         terrain_texture = raster::extract(terrain_texture, plots),
         topographic_position = raster::extract(topographic_position, plots)) 
```

## Making shapefiles of survival data for mapping

```{r}
planting_survival_spatial <- right_join(planting_survival, plots_topography, by = "plot_number") %>% 
  drop_na(Plant)
may_survival_spatial <- right_join(watering_survival, plots_topography, by = "plot_number") %>% 
  drop_na(Plant)
july_survival_spatial <- right_join(measuring_survival, plots_topography, by = "plot_number") %>% 
  drop_na(Plant)
november_survival_spatial <- right_join(measuring_survival_2, plots_topography, by = "plot_number") %>% 
  drop_na(Plant)
december_survival_spatial <- right_join(measuring_survival_3, plots_topography, by = "plot_number") %>% 
  drop_na(Plant)
```


## Combining spatial/topography data with survival data


```{r}
planting_survival_gopher_topography <- right_join(planting_survival_gopher, plots_topography, by = "plot_number") %>% 
  drop_na(Plant)
planting_gopher_topography_summary <- planting_survival_gopher_topography %>% 
  group_by(Plant, date) %>% 
  summarise(elevation_mean = mean(elevation, na.rm =TRUE),
            aspect_mean = mean(aspect, na.rm = TRUE),
            slope_mean = mean(slope, na.rm = TRUE),
            summer_solar_radiation_mean = mean(summer_solar_radiation, na.rm = TRUE),
            spring_solar_radiation_mean = mean(spring_solar_radiation, na.rm = TRUE),
            winter_solar_radiation_mean = mean(winter_solar_radiation, na.rm = TRUE),
            elevation_sd = sd(elevation, na.rm =TRUE),
            aspect_sd = sd(aspect, na.rm = TRUE),
            slope_sd = sd(slope, na.rm = TRUE),
            summer_solar_radiation_sd = sd(summer_solar_radiation, na.rm = TRUE),
            spring_solar_radiation_sd = sd(spring_solar_radiation, na.rm = TRUE),
            winter_solar_radiation_sd = sd(winter_solar_radiation, na.rm = TRUE))

watering_survival_gopher_topography <- right_join(watering_survival_gopher, plots_topography, by = "plot_number") %>% 
  drop_na(Plant) 
watering_gopher_topography_summary <- watering_survival_gopher_topography %>% 
  group_by(Plant, date, alive) %>% 
  summarise(elevation_mean = mean(elevation, na.rm =TRUE),
            aspect_mean = mean(aspect, na.rm = TRUE),
            slope_mean = mean(slope, na.rm = TRUE),
            summer_solar_radiation_mean = mean(summer_solar_radiation, na.rm = TRUE),
            spring_solar_radiation_mean = mean(spring_solar_radiation, na.rm = TRUE),
            winter_solar_radiation_mean = mean(winter_solar_radiation, na.rm = TRUE),
            elevation_sd = sd(elevation, na.rm =TRUE),
            aspect_sd = sd(aspect, na.rm = TRUE),
            slope_sd = sd(slope, na.rm = TRUE),
            summer_solar_radiation_sd = sd(summer_solar_radiation, na.rm = TRUE),
            spring_solar_radiation_sd = sd(spring_solar_radiation, na.rm = TRUE),
            winter_solar_radiation_sd = sd(winter_solar_radiation, na.rm = TRUE))

measuring_survival_gopher_topography <- right_join(measuring_survival_gopher, plots_topography, by = "plot_number") %>% 
  drop_na() 
measuring_gopher_topography_summary <- measuring_survival_gopher_topography %>% 
  group_by(Plant, date, alive) %>% 
  summarise(elevation_mean = mean(elevation, na.rm =TRUE),
            aspect_mean = mean(aspect, na.rm = TRUE),
            slope_mean = mean(slope, na.rm = TRUE),
            summer_solar_radiation_mean = mean(summer_solar_radiation, na.rm = TRUE),
            spring_solar_radiation_mean = mean(spring_solar_radiation, na.rm = TRUE),
            winter_solar_radiation_mean = mean(winter_solar_radiation, na.rm = TRUE),
            elevation_sd = sd(elevation, na.rm =TRUE),
            aspect_sd = sd(aspect, na.rm = TRUE),
            slope_sd = sd(slope, na.rm = TRUE),
            summer_solar_radiation_sd = sd(summer_solar_radiation, na.rm = TRUE),
            spring_solar_radiation_sd = sd(spring_solar_radiation, na.rm = TRUE),
            winter_solar_radiation_sd = sd(winter_solar_radiation, na.rm = TRUE))

measuring_survival_gopher_2_topography <- right_join(measuring_survival_gopher_2, plots_topography, by = "plot_number") %>% 
  drop_na()
measuring_gopher_topography_summary_2 <- measuring_survival_gopher_2_topography %>% 
  group_by(Plant, date, alive) %>% 
  summarise(elevation_mean = mean(elevation, na.rm =TRUE),
            aspect_mean = mean(aspect, na.rm = TRUE),
            slope_mean = mean(slope, na.rm = TRUE),
            summer_solar_radiation_mean = mean(summer_solar_radiation, na.rm = TRUE),
            spring_solar_radiation_mean = mean(spring_solar_radiation, na.rm = TRUE),
            winter_solar_radiation_mean = mean(winter_solar_radiation, na.rm = TRUE),
            elevation_sd = sd(elevation, na.rm =TRUE),
            aspect_sd = sd(aspect, na.rm = TRUE),
            slope_sd = sd(slope, na.rm = TRUE),
            summer_solar_radiation_sd = sd(summer_solar_radiation, na.rm = TRUE),
            spring_solar_radiation_sd = sd(spring_solar_radiation, na.rm = TRUE),
            winter_solar_radiation_sd = sd(winter_solar_radiation, na.rm = TRUE))

measuring_survival_gopher_3_topography <- right_join(measuring_survival_gopher_3, plots_topography, by = "plot_number") %>% 
  drop_na()
measuring_gopher_topography_summary_3 <- measuring_survival_gopher_3_topography %>% 
  group_by(Plant, date, alive) %>% 
  summarise(elevation_mean = mean(elevation, na.rm =TRUE),
            aspect_mean = mean(aspect, na.rm = TRUE),
            slope_mean = mean(slope, na.rm = TRUE),
            summer_solar_radiation_mean = mean(summer_solar_radiation, na.rm = TRUE),
            spring_solar_radiation_mean = mean(spring_solar_radiation, na.rm = TRUE),
            winter_solar_radiation_mean = mean(winter_solar_radiation, na.rm = TRUE),
            elevation_sd = sd(elevation, na.rm =TRUE),
            aspect_sd = sd(aspect, na.rm = TRUE),
            slope_sd = sd(slope, na.rm = TRUE),
            summer_solar_radiation_sd = sd(summer_solar_radiation, na.rm = TRUE),
            spring_solar_radiation_sd = sd(spring_solar_radiation, na.rm = TRUE),
            winter_solar_radiation_sd = sd(winter_solar_radiation, na.rm = TRUE))

topography_gopher_survival <- rbind(planting_survival_gopher_topography, 
                                    watering_survival_gopher_topography) %>% 
  rbind(measuring_survival_gopher_topography) %>% 
  rbind(measuring_survival_gopher_2_topography) %>% 
  rbind(measuring_survival_gopher_3_topography)  %>% 
  mutate(alive = replace_na(alive, 1),
         alive = as.factor(alive)) %>% 
  filter(Plant != "No Plant")
  
topography_gopher_may <- topography_gopher_survival %>% 
  filter(date == "2020-05-01") 

may_alive <- topography_gopher_may %>% 
  filter(alive == 1) %>% 
  select(plot_number)

topography_gopher_july <- topography_gopher_survival %>% 
  filter(date == "2020-07-01") %>% 
  filter(plot_number %in% may_alive$plot_number)

july_alive <- topography_gopher_july %>% 
  filter(alive == 1) %>% 
  select(plot_number)

topography_gopher_november <- topography_gopher_survival %>% 
  filter(date == "2020-11-01") %>% 
  filter(plot_number %in% july_alive$plot_number)

november_alive <- topography_gopher_november %>% 
  filter(alive == 1) %>% 
  select(plot_number)

topography_gopher_2021 <- topography_gopher_survival %>% 
  filter(date == "2021-12-01") %>% 
  filter(plot_number %in% november_alive$plot_number)
```

## Binomial regression for may survival

```{r}
watering_binomial <- topography_gopher_may %>% 
  dplyr::select(!plot_number & !date & !geometry)  
  
watering_elevation <- glm(family = "binomial", as.factor(alive)~elevation, data = watering_binomial)
watering_aspect <- glm(family = "binomial", as.factor(alive)~aspect, data = watering_binomial)
watering_slope <- glm(family = "binomial", as.factor(alive)~slope, data = watering_binomial)
watering_summer_solar_radiation <- glm(family = "binomial", as.factor(alive)~summer_solar_radiation, data = watering_binomial)
watering_spring_solar_radiation <- glm(family = "binomial", as.factor(alive)~spring_solar_radiation, data = watering_binomial)
watering_winter_solar_radiation <- glm(family = "binomial", as.factor(alive)~winter_solar_radiation, data = watering_binomial)
watering_diurnal_heat <- glm(family = "binomial", as.factor(alive)~diurnal_heat, data = watering_binomial)
watering_heat_load <- glm(family = "binomial", as.factor(alive)~heat_load, data = watering_binomial)
watering_hierarchical_slope_position <- glm(family = "binomial", as.factor(alive)~hierarchical_slope_position, data = watering_binomial)
watering_integrated_moisture <- glm(family = "binomial", as.factor(alive)~integrated_moisture, data = watering_binomial)
watering_ruggedness_vector <- glm(family = "binomial", as.factor(alive)~ruggedness_vector, data = watering_binomial)
watering_sol_rad_aspect <- glm(family = "binomial", as.factor(alive)~sol_rad_aspect, data = watering_binomial)
watering_terrain_ruggedness <- glm(family = "binomial", as.factor(alive)~terrain_ruggedness, data = watering_binomial)
watering_terrain_roughness <- glm(family = "binomial", as.factor(alive)~terrain_roughness, data = watering_binomial)
watering_terrain_texture <- glm(family = "binomial", as.factor(alive)~terrain_texture, data = watering_binomial)
watering_topographic_position <- glm(family = "binomial", as.factor(alive)~topographic_position, data = watering_binomial)

summary(watering_elevation)
summary(watering_aspect)
summary(watering_slope)
summary(watering_summer_solar_radiation)
summary(watering_spring_solar_radiation)
summary(watering_winter_solar_radiation)
summary(watering_diurnal_heat)
summary(watering_heat_load)
summary(watering_hierarchical_slope_position)
summary(watering_integrated_moisture)
summary(watering_ruggedness_vector)
summary(watering_sol_rad_aspect)
summary(watering_terrain_ruggedness)
summary(watering_terrain_roughness)
summary(watering_terrain_texture)
summary(watering_topographic_position)

effect_plot(watering_elevation, 
            pred = elevation, 
            interval = TRUE)
effect_plot(watering_aspect, 
            pred = aspect, 
            interval = TRUE)
effect_plot(watering_slope, 
            pred = slope, 
            interval = TRUE)
effect_plot(watering_summer_solar_radiation, 
            pred = summer_solar_radiation, 
            interval = TRUE)
effect_plot(watering_spring_solar_radiation, 
            pred = spring_solar_radiation, 
            interval = TRUE)
effect_plot(watering_winter_solar_radiation, 
            pred = winter_solar_radiation, 
            interval = TRUE)
effect_plot(watering_diurnal_heat, 
            pred = diurnal_heat, 
            interval = TRUE)
effect_plot(watering_heat_load, 
            pred = heat_load, 
            interval = TRUE)
effect_plot(watering_hierarchical_slope_position, 
            pred = hierarchical_slope_position, 
            interval = TRUE)
effect_plot(watering_integrated_moisture, 
            pred = integrated_moisture, 
            interval = TRUE)
effect_plot(watering_ruggedness_vector, 
            pred = ruggedness_vector, 
            interval = TRUE)
effect_plot(watering_sol_rad_aspect, 
            pred = sol_rad_aspect, 
            interval = TRUE)
effect_plot(watering_terrain_ruggedness, 
            pred = terrain_ruggedness, 
            interval = TRUE)
effect_plot(watering_terrain_roughness, 
            pred = terrain_roughness, 
            interval = TRUE)
effect_plot(watering_terrain_texture, 
            pred = terrain_texture, 
            interval = TRUE)
effect_plot(watering_topographic_position, 
            pred = topographic_position, 
            interval = TRUE)
```

## Binomial regression for July survival

```{r}
july_binomial <- topography_gopher_july %>% 
  dplyr::select(!plot_number & !date & !geometry)  
  
july_elevation <- glm(family = "binomial", as.factor(alive)~elevation, data = july_binomial)
july_aspect <- glm(family = "binomial", as.factor(alive)~aspect, data = july_binomial)
july_slope <- glm(family = "binomial", as.factor(alive)~slope, data = july_binomial)
july_summer_solar_radiation <- glm(family = "binomial", as.factor(alive)~summer_solar_radiation, data = july_binomial)
july_spring_solar_radiation <- glm(family = "binomial", as.factor(alive)~spring_solar_radiation, data = july_binomial)
july_winter_solar_radiation <- glm(family = "binomial", as.factor(alive)~winter_solar_radiation, data = july_binomial)
july_diurnal_heat <- glm(family = "binomial", as.factor(alive)~diurnal_heat, data = july_binomial)
july_heat_load <- glm(family = "binomial", as.factor(alive)~heat_load, data = july_binomial)
july_hierarchical_slope_position <- glm(family = "binomial", as.factor(alive)~hierarchical_slope_position, data = july_binomial)
july_integrated_moisture <- glm(family = "binomial", as.factor(alive)~integrated_moisture, data = july_binomial)
july_ruggedness_vector <- glm(family = "binomial", as.factor(alive)~ruggedness_vector, data = july_binomial)
july_sol_rad_aspect <- glm(family = "binomial", as.factor(alive)~sol_rad_aspect, data = july_binomial)
july_terrain_ruggedness <- glm(family = "binomial", as.factor(alive)~terrain_ruggedness, data = july_binomial)
july_terrain_roughness <- glm(family = "binomial", as.factor(alive)~terrain_roughness, data = july_binomial)
july_terrain_texture <- glm(family = "binomial", as.factor(alive)~terrain_texture, data = july_binomial)
july_topographic_position <- glm(family = "binomial", as.factor(alive)~topographic_position, data = july_binomial)

summary(july_elevation)
summary(july_aspect)
summary(july_slope)
summary(july_summer_solar_radiation)
summary(july_spring_solar_radiation)
summary(july_winter_solar_radiation)
summary(july_diurnal_heat)
summary(july_heat_load)
summary(july_hierarchical_slope_position)
summary(july_integrated_moisture)
summary(july_ruggedness_vector)
summary(july_sol_rad_aspect)
summary(july_terrain_ruggedness)
summary(july_terrain_roughness)
summary(july_terrain_texture)
summary(july_topographic_position)

effect_plot(july_elevation, 
            pred = elevation, 
            interval = TRUE)
effect_plot(july_aspect, 
            pred = aspect, 
            interval = TRUE)
effect_plot(july_slope, 
            pred = slope, 
            interval = TRUE)
effect_plot(july_summer_solar_radiation, 
            pred = summer_solar_radiation, 
            interval = TRUE)
effect_plot(july_spring_solar_radiation, 
            pred = spring_solar_radiation, 
            interval = TRUE)
effect_plot(july_winter_solar_radiation, 
            pred = winter_solar_radiation, 
            interval = TRUE)
effect_plot(july_diurnal_heat, 
            pred = diurnal_heat, 
            interval = TRUE)
effect_plot(july_heat_load, 
            pred = heat_load, 
            interval = TRUE)
effect_plot(july_hierarchical_slope_position, 
            pred = hierarchical_slope_position, 
            interval = TRUE)
effect_plot(july_integrated_moisture, 
            pred = integrated_moisture, 
            interval = TRUE)
effect_plot(july_ruggedness_vector, 
            pred = ruggedness_vector, 
            interval = TRUE)
effect_plot(july_sol_rad_aspect, 
            pred = sol_rad_aspect, 
            interval = TRUE)
effect_plot(july_terrain_ruggedness, 
            pred = terrain_ruggedness, 
            interval = TRUE)
effect_plot(july_terrain_roughness, 
            pred = terrain_roughness, 
            interval = TRUE)
effect_plot(july_terrain_texture, 
            pred = terrain_texture, 
            interval = TRUE)
effect_plot(july_topographic_position, 
            pred = topographic_position, 
            interval = TRUE)
```

## Binomial regression for november survival

```{r}
november_binomial <- topography_gopher_november %>% 
  dplyr::select(!plot_number & !date & !geometry)  
  
november_elevation <- glm(family = "binomial", as.factor(alive)~elevation, data = november_binomial)
november_aspect <- glm(family = "binomial", as.factor(alive)~aspect, data = november_binomial)
november_slope <- glm(family = "binomial", as.factor(alive)~slope, data = november_binomial)
november_summer_solar_radiation <- glm(family = "binomial", as.factor(alive)~summer_solar_radiation, data = november_binomial)
november_spring_solar_radiation <- glm(family = "binomial", as.factor(alive)~spring_solar_radiation, data = november_binomial)
november_winter_solar_radiation <- glm(family = "binomial", as.factor(alive)~winter_solar_radiation, data = november_binomial)
november_diurnal_heat <- glm(family = "binomial", as.factor(alive)~diurnal_heat, data = november_binomial)
november_heat_load <- glm(family = "binomial", as.factor(alive)~heat_load, data = november_binomial)
november_hierarchical_slope_position <- glm(family = "binomial", as.factor(alive)~hierarchical_slope_position, data = november_binomial)
november_integrated_moisture <- glm(family = "binomial", as.factor(alive)~integrated_moisture, data = november_binomial)
november_ruggedness_vector <- glm(family = "binomial", as.factor(alive)~ruggedness_vector, data = november_binomial)
november_sol_rad_aspect <- glm(family = "binomial", as.factor(alive)~sol_rad_aspect, data = november_binomial)
november_terrain_ruggedness <- glm(family = "binomial", as.factor(alive)~terrain_ruggedness, data = november_binomial)
november_terrain_roughness <- glm(family = "binomial", as.factor(alive)~terrain_roughness, data = november_binomial)
november_terrain_texture <- glm(family = "binomial", as.factor(alive)~terrain_texture, data = november_binomial)
november_topographic_position <- glm(family = "binomial", as.factor(alive)~topographic_position, data = november_binomial)

summary(november_elevation)
summary(november_aspect)
summary(november_slope)
summary(november_summer_solar_radiation)
summary(november_spring_solar_radiation)
summary(november_winter_solar_radiation)
summary(november_diurnal_heat)
summary(november_heat_load)
summary(november_hierarchical_slope_position)
summary(november_integrated_moisture)
summary(november_ruggedness_vector)
summary(november_sol_rad_aspect)
summary(november_terrain_ruggedness)
summary(november_terrain_roughness)
summary(november_terrain_texture)
summary(november_topographic_position)

effect_plot(november_elevation, 
            pred = elevation, 
            interval = TRUE)
effect_plot(november_aspect, 
            pred = aspect, 
            interval = TRUE)
effect_plot(november_slope, 
            pred = slope, 
            interval = TRUE)
effect_plot(november_summer_solar_radiation, 
            pred = summer_solar_radiation, 
            interval = TRUE)
effect_plot(november_spring_solar_radiation, 
            pred = spring_solar_radiation, 
            interval = TRUE)
effect_plot(november_winter_solar_radiation, 
            pred = winter_solar_radiation, 
            interval = TRUE)
effect_plot(november_diurnal_heat, 
            pred = diurnal_heat, 
            interval = TRUE)
effect_plot(november_heat_load, 
            pred = heat_load, 
            interval = TRUE)
effect_plot(november_hierarchical_slope_position, 
            pred = hierarchical_slope_position, 
            interval = TRUE)
effect_plot(november_integrated_moisture, 
            pred = integrated_moisture, 
            interval = TRUE)
effect_plot(november_ruggedness_vector, 
            pred = ruggedness_vector, 
            interval = TRUE)
effect_plot(november_sol_rad_aspect, 
            pred = sol_rad_aspect, 
            interval = TRUE)
effect_plot(november_terrain_ruggedness, 
            pred = terrain_ruggedness, 
            interval = TRUE)
effect_plot(november_terrain_roughness, 
            pred = terrain_roughness, 
            interval = TRUE)
effect_plot(november_terrain_texture, 
            pred = terrain_texture, 
            interval = TRUE)
effect_plot(november_topographic_position, 
            pred = topographic_position, 
            interval = TRUE)
```

## Binomial regression for December 2021

```{r}
december_binomial <- topography_gopher_2021 %>% 
  dplyr::select(!plot_number & !date & !geometry)  
  
december_elevation <- glm(family = "binomial", as.factor(alive)~elevation, data = december_binomial)
december_aspect <- glm(family = "binomial", as.factor(alive)~aspect, data = december_binomial)
december_slope <- glm(family = "binomial", as.factor(alive)~slope, data = december_binomial)
december_summer_solar_radiation <- glm(family = "binomial", as.factor(alive)~summer_solar_radiation, data = december_binomial)
december_spring_solar_radiation <- glm(family = "binomial", as.factor(alive)~spring_solar_radiation, data = december_binomial)
december_winter_solar_radiation <- glm(family = "binomial", as.factor(alive)~winter_solar_radiation, data = december_binomial)
december_diurnal_heat <- glm(family = "binomial", as.factor(alive)~diurnal_heat, data = december_binomial)
december_heat_load <- glm(family = "binomial", as.factor(alive)~heat_load, data = december_binomial)
december_hierarchical_slope_position <- glm(family = "binomial", as.factor(alive)~hierarchical_slope_position, data = december_binomial)
december_integrated_moisture <- glm(family = "binomial", as.factor(alive)~integrated_moisture, data = december_binomial)
december_ruggedness_vector <- glm(family = "binomial", as.factor(alive)~ruggedness_vector, data = december_binomial)
december_sol_rad_aspect <- glm(family = "binomial", as.factor(alive)~sol_rad_aspect, data = december_binomial)
december_terrain_ruggedness <- glm(family = "binomial", as.factor(alive)~terrain_ruggedness, data = december_binomial)
december_terrain_roughness <- glm(family = "binomial", as.factor(alive)~terrain_roughness, data = december_binomial)
december_terrain_texture <- glm(family = "binomial", as.factor(alive)~terrain_texture, data = december_binomial)
december_topographic_position <- glm(family = "binomial", as.factor(alive)~topographic_position, data = december_binomial)

summary(december_elevation)
summary(december_aspect)
summary(december_slope)
summary(december_summer_solar_radiation)
summary(december_spring_solar_radiation)
summary(december_winter_solar_radiation)
summary(december_diurnal_heat)
summary(december_heat_load)
summary(december_hierarchical_slope_position)
summary(december_integrated_moisture)
summary(december_ruggedness_vector)
summary(december_sol_rad_aspect)
summary(december_terrain_ruggedness)
summary(december_terrain_roughness)
summary(december_terrain_texture)
summary(december_topographic_position)

effect_plot(december_elevation, 
            pred = elevation, 
            interval = TRUE)
effect_plot(december_aspect, 
            pred = aspect, 
            interval = TRUE)
effect_plot(december_slope, 
            pred = slope, 
            interval = TRUE)
effect_plot(december_summer_solar_radiation, 
            pred = summer_solar_radiation, 
            interval = TRUE)
effect_plot(december_spring_solar_radiation, 
            pred = spring_solar_radiation, 
            interval = TRUE)
effect_plot(december_winter_solar_radiation, 
            pred = winter_solar_radiation, 
            interval = TRUE)
effect_plot(december_diurnal_heat, 
            pred = diurnal_heat, 
            interval = TRUE)
effect_plot(december_heat_load, 
            pred = heat_load, 
            interval = TRUE)
effect_plot(december_hierarchical_slope_position, 
            pred = hierarchical_slope_position, 
            interval = TRUE)
effect_plot(december_integrated_moisture, 
            pred = integrated_moisture, 
            interval = TRUE)
effect_plot(december_ruggedness_vector, 
            pred = ruggedness_vector, 
            interval = TRUE)
effect_plot(december_sol_rad_aspect, 
            pred = sol_rad_aspect, 
            interval = TRUE)
effect_plot(december_terrain_ruggedness, 
            pred = terrain_ruggedness, 
            interval = TRUE)
effect_plot(december_terrain_roughness, 
            pred = terrain_roughness, 
            interval = TRUE)
effect_plot(december_terrain_texture, 
            pred = terrain_texture, 
            interval = TRUE)
effect_plot(december_topographic_position, 
            pred = topographic_position, 
            interval = TRUE)
```

```{r}
set.seed(123)
may_survival_tree_data <- topography_gopher_may %>%
  select(!plot_number & !date & !geometry) %>% 
  mutate(Plant = as.factor(Plant))
may_survival_tree <- partykit::ctree(alive ~., data = may_survival_tree_data)

ggparty(may_survival_tree) +
  geom_edge() +
  geom_edge_label(id = -c(3,4), size = 3)+
  geom_edge_label(size = 3, aes(label = paste(substr(breaks_label,start = 1, stop = 15))),
                  id = c(3,4))+
  geom_node_splitvar()+
  geom_node_plot(gglist = list(geom_bar(aes(x=  "", fill = alive),
                                        position = position_fill()),
                               xlab("alive")))
```

```{r}
set.seed(123)
july_survival_tree_data <- topography_gopher_july %>% 
  select(!plot_number & !date & !geometry) %>% 
  mutate(Plant = as.factor(Plant)) 
july_survival_tree <- partykit::ctree(alive ~., data = july_survival_tree_data)

ggparty(july_survival_tree) +
  geom_edge() +
  geom_edge_label(size = 2) +
  geom_node_splitvar()+
  geom_node_plot(gglist = list(geom_bar(aes(x=  "", fill = alive),
                                        position = position_fill()),
                               xlab("alive")))
```

```{r}
set.seed(123)
november_survival_tree_data <- topography_gopher_november %>% 
  select(!plot_number & !date & !geometry)%>% 
  mutate(Plant = as.factor(Plant))
november_survival_tree <- partykit::ctree(alive ~., data = november_survival_tree_data)

ggparty(november_survival_tree) +
  geom_edge() +
  geom_edge_label(size = 3, aes(label = paste(substr(breaks_label,start = 1, stop = 15))),
                  id = c(1:5))+
  geom_node_splitvar()+
  geom_node_plot(gglist = list(geom_bar(aes(x=  "", fill = alive),
                                        position = position_fill()),
                               xlab("alive")))
```

```{r}
set.seed(123)
december_survival_tree_data <- topography_gopher_2021 %>% 
  select(!plot_number & !date & !geometry)%>% 
  mutate(Plant = as.factor(Plant)) 
december_survival_tree <- partykit::ctree(alive ~., data = december_survival_tree_data)

ggparty(december_survival_tree) +
  geom_edge() +
  geom_edge_label(size = 2.5)+
  geom_node_splitvar()+
  geom_node_plot(gglist = list(geom_bar(aes(x=  "", fill = alive),
                                        position = position_fill()),
                               xlab("alive")))
```

## Survival from plant to November 

```{r}
november_all_survival <- topography_gopher_survival %>% 
  filter(date == "2020-11-01") %>% 
  select(!plot_number & !date & !geometry)%>% 
  mutate(Plant = as.factor(Plant)) 

set.seed(123)
november_all_survival_tree <- partykit::ctree(alive ~., data = november_all_survival)

ggparty(november_all_survival_tree) +
  geom_edge() +
  geom_edge_label(size = 2.5)+
  geom_node_splitvar()+
  geom_node_plot(gglist = list(geom_bar(aes(x=  "", fill = alive),
                                        position = position_fill()),
                               xlab("alive")))
```

```{r}
november_all_survival <- november_all_survival[, c(2,1,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18)]
set.seed(123)
for (x in c(500, 600, 700, 800, 900, 1000)) {
  tuneRF(november_all_survival[-1],
       november_all_survival$alive, 
       ntreeTry=x,stepFactor = 1.5, 
       improve = 0.01, 
       trace =TRUE, 
       plot = FALSE)
}
set.seed(123)
november_all_survival_forest <- randomForest(alive ~., data = november_all_survival,
                              type = prob,
                              ntree = 800,
                              mtry = 9,
                              importance = TRUE)
november_all_survival_forest


november_all_rf <- data.frame(november_all_survival_forest$importance) %>% 
  dplyr::select("MeanDecreaseAccuracy") %>% 
  rownames_to_column(var = "variables")

november_all_rf_plot <- ggplot(november_all_rf, aes(fct_reorder(variables, MeanDecreaseAccuracy),MeanDecreaseAccuracy))+
  geom_bar(stat= "identity")+
  coord_flip() +
  labs(x = "Variables",
       y = "Percent increase in \n mean square error")+
  theme_classic()
november_all_rf_plot

```

