---
title: "Piru Progress"
author: "Shane Dewees"
date: "12/15/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(here)
library(lubridate)
library(sf)
library(raster)
library(tidyverse)
library(stats)
library(jtools)
library(ggparty)
library(partykit)
library(randomForest)
```

```{r}
planting <- read.csv(here("data", "planting.csv")) %>% 
  rename("plot_number" = "ID")
watering <- read.csv(here("data","watering.csv"))%>% 
  rename("plot_number" = "ID")
measuring <- read.csv(here("data", "measuring.csv"))%>% 
  rename("plot_number" = "ID")
measuring_2 <- read.csv(here("data", "measuring_2.csv"))%>% 
  rename("plot_number" = "ID")
measuring_3 <- read.csv(here("data", "measuring_3.csv"))%>% 
  rename("plot_number" = "ID")

# Table of only plants alive by March 2020
planting_survival <- planting %>% 
  dplyr::select(plot_number, Plant, Height, Date.Planted) %>% 
  mutate(Plant = str_replace_all(string = Plant, pattern = "(White + Pink)", replacement = "")) %>% 
  mutate(Plant = case_when(Plant == "ENCA (Pink)" ~ "ENCA",
                           Plant == "CEOL (Orange)" ~ "CEOL",
                           Plant == "HEWH (White)" ~ "HEWH",
                           Plant == "SAME (Orange + Pink)" ~ "SAME",
                           Plant == "SANI (Orange + Yellow)" ~ "SANI",
                           Plant == "RHOV (White + Pink)" ~ "RHOV",
                           Plant == "SAAP (White + Green)" ~ "SAAP",
                           Plant == "MALA (White + Yellow)" ~ "MALA",
                           Plant == "HEAR" ~ "HEAR",
                           Plant == "ADFA (Orange + Green)" ~ "ADFA",
                           Plant == "RHOV SAAP (White + Pink)" ~ "SAAP",
                           Plant == "ENCA CEOL (Pink)" ~ "CEOL", 
                           Plant == "HEWH (White) RHOV" ~ "RHOV",
                           Plant == "NO PLANT" ~ "No Plant")) %>% 
  filter(Plant != "No Plant", Height != "") %>% 
  mutate(date = my(0320),
         alive = 1) %>% 
  dplyr::select(plot_number,Plant, alive, date)

# Table of plant survival as of May 2020
watering_survival <- watering %>% 
  mutate(Plant = case_when(Plant == "ENCA (Pink)" ~ "ENCA",
                           Plant == "CEOL (Orange)" ~ "CEOL",
                           Plant == "HEWH (White)" ~ "HEWH",
                           Plant == "SAME (Orange + Pink)" ~ "SAME",
                           Plant == "SANI (Orange + Yellow)" ~ "SANI",
                           Plant == "RHOV (White + Pink)" ~ "RHOV",
                           Plant == "SANI (Orange + Yellow) CEOL" ~ "CEOL",
                           Plant == "SAAP (White + Green)" ~ "SAAP",
                           Plant == "MALA (White + Yellow)" ~ "MALA",
                           Plant == "SANI  MALA" ~ "MALA",
                           Plant == "HEAR" ~ "HEAR",
                           Plant == "ADFA (Orange + Green)" ~ "ADFA",
                           Plant == "HEWH (White) ENCA" ~ "ENCA",
                           Plant == "ADFA" ~ "ADFA",
                           Plant == "SANI" ~ "SANI",
                           Plant == "SAME" ~ "SAME",
                           Plant == "SANI " ~ "SANI",
                           Plant == "" ~"No plant")) %>% 
  filter(Plant != "No plant") %>% 
  mutate(alive = case_when(Alive.1 == "y" ~ 1,
                           Alive.1 == "Y" ~ 1,
                           Alive.1 == "n" ~ 0,
                           Alive.1 == "np" ~ 0,
                           Alive.1 == "" ~ 0,
                           Alive.1 == "N" ~ 0,
                           Alive.1 == "NP" ~ 0),
         date = my(0520)) %>% 
  dplyr::select(plot_number,Plant, alive, date)

# Table of plant survival as of July 2020
measuring_survival <- measuring %>% 
  mutate(Plant = case_when(Plant == "ENCA (Pink)" ~ "ENCA",
                           Plant == "CEOL (Orange)" ~ "CEOL",
                           Plant == "HEWH (White)" ~ "HEWH",
                           Plant == "SAME (Orange + Pink)" ~ "SAME",
                           Plant == "SANI (Orange + Yellow)" ~ "SANI", 
                           Plant == "RHOV (White + Pink)" ~ "RHOV",
                           Plant == "SAAP (White + Green)" ~ "SAAP",
                           Plant == "MALA (White + Yellow)" ~ "MALA",
                           Plant == "ADFA (Orange + Green)" ~ "ADFA",
                           Plant == "HEAR" ~ "HEAR",
                           Plant == "ENCA CEOL (Pink)" ~ "CEOL",
                           Plant == "NO PLANT" ~ "No Plant",
                           Plant == "HEWH (White) RHOV" ~ "RHOV",
                           Plant == "HEWH" ~ "HEWH"),
         alive = case_when(Height > 0 ~ 1),
         date = my(0720)) %>% 
  filter(Plant != "No Plant") %>% 
  dplyr::select(plot_number,Plant, alive, date)

# Table of plant survival as of November 2020
measuring_survival_2 <- measuring_2 %>% 
  mutate(Plant = str_replace(Plant, " ", ""),
         alive = case_when(Height > 0 ~ 1,
                           TRUE ~ 0),
         date = my(1120)) %>% 
  filter(Plant != "") %>% 
  dplyr::select(plot_number,Plant, alive, date)

# Table of plant survival as of December 2021
measuring_survival_3 <- measuring_3 %>% 
  mutate(alive = case_when(Height > 0 ~ 1),
        date = my(1221)) %>% 
  filter(Plant != "") %>% 
  dplyr::select(plot_number,Plant, alive, date)

# Table of percent each species alive at all dates
survival <- rbind(planting_survival,watering_survival,measuring_survival, measuring_survival_2, measuring_survival_3) %>% 
  group_by(Plant, date) %>% 
  summarise(alive = sum(alive, na.rm = TRUE)) %>% 
  mutate(alive_percent = case_when(Plant == "ADFA" ~ alive/148 * 100,
                                   Plant == "CEOL" ~ alive/250 * 100,
                                   Plant == "ENCA" ~ alive/204 * 100,
                                   Plant == "HEAR" ~ alive/121 * 100,
                                   Plant == "HEWH" ~ alive/247 * 100,
                                   Plant == "MALA" ~ alive/89 * 100,
                                   Plant == "RHOV" ~ alive/195 * 100,
                                   Plant == "SAAP" ~ alive/95 * 100,
                                   Plant == "SAME" ~ alive/130 * 100, 
                                   Plant == "SANI" ~ alive/160 * 100),
         Plant = case_when(Plant == "ADFA" ~ "Adenostoma fasciculatum",
                                   Plant == "CEOL" ~ "Ceanothus oliganthus",
                                   Plant == "ENCA" ~ "Encelia californica",
                                   Plant == "HEAR" ~ "Heteromeles arbutifolia",
                                   Plant == "HEWH" ~ "Hesperoyucca whipplei",
                                   Plant == "MALA" ~ "Malosma laurina",
                                   Plant == "RHOV" ~ "Rhus ovata",
                                   Plant == "SAAP" ~ "Salvia apiana",
                                   Plant == "SAME" ~ "Salvia mellifera", 
                                   Plant == "SANI" ~ "Sambucus nigra"))

# Table of percent alive for all species combined
survival_total <- survival %>% 
  group_by(date) %>% 
  summarise(alive = sum(alive))

ggplot(survival, aes(date, alive_percent)) +
  geom_point() +
  geom_line () +
  facet_wrap(~Plant, nrow = 5, ncol = 2) +
  labs(y = "Percent Alive") +
  theme_classic()

ggplot(survival, aes(date, alive)) +
  geom_point() +
  geom_line () +
  facet_wrap(~Plant, nrow = 5, ncol = 2) +
  theme_classic()

ggplot(survival_total, aes(date, alive)) +
  geom_point() +
  geom_line() +
  labs(y = "Number plants alive") +
  theme_classic()
  
```

## Cleaning and initial visualization of growth data

```{r}
# Growth data as of March 2020
planting_growth <- planting %>% 
  mutate(Plant = str_replace_all(string = Plant, pattern = "(White + Pink)", replacement = "")) %>% 
  mutate(Plant = case_when(Plant == "ENCA (Pink)" ~ "ENCA",
                           Plant == "CEOL (Orange)" ~ "CEOL",
                           Plant == "HEWH (White)" ~ "HEWH",
                           Plant == "SAME (Orange + Pink)" ~ "SAME",
                           Plant == "SANI (Orange + Yellow)" ~ "SANI",
                           Plant == "RHOV (White + Pink)" ~ "RHOV",
                           Plant == "SAAP (White + Green)" ~ "SAAP",
                           Plant == "MALA (White + Yellow)" ~ "MALA",
                           Plant == "HEAR" ~ "HEAR",
                           Plant == "ADFA (Orange + Green)" ~ "ADFA",
                           Plant == "RHOV SAAP (White + Pink)" ~ "SAAP",
                           Plant == "ENCA CEOL (Pink)" ~ "CEOL", 
                           Plant == "HEWH (White) RHOV" ~ "RHOV",
                           Plant == "NO PLANT" ~ "No Plant")) %>% 
  filter(Plant != "No Plant", Height != "") %>% 
  mutate(date = my(0320)) %>% 
  dplyr::select(plot_number,Plant, Height, Width.1, Width.2, Stem.Diameter, date)

# Growth data as of July 2020
measuring_growth <- measuring %>% 
  mutate(Plant = case_when(Plant == "ENCA (Pink)" ~ "ENCA",
                           Plant == "CEOL (Orange)" ~ "CEOL",
                           Plant == "HEWH (White)" ~ "HEWH",
                           Plant == "SAME (Orange + Pink)" ~ "SAME",
                           Plant == "SANI (Orange + Yellow)" ~ "SANI", 
                           Plant == "RHOV (White + Pink)" ~ "RHOV",
                           Plant == "SAAP (White + Green)" ~ "SAAP",
                           Plant == "MALA (White + Yellow)" ~ "MALA",
                           Plant == "ADFA (Orange + Green)" ~ "ADFA",
                           Plant == "HEAR" ~ "HEAR",
                           Plant == "ENCA CEOL (Pink)" ~ "CEOL",
                           Plant == "NO PLANT" ~ "No Plant",
                           Plant == "HEWH (White) RHOV" ~ "RHOV",
                           Plant == "HEWH" ~ "HEWH"),
         date = my(0720)) %>% 
  filter(Plant != "No Plant") %>% 
  dplyr::select(plot_number,Plant, Height, Width.1, Width.2, Stem.Diameter, date)

# Growth data as of November 2020
measuring_growth_2 <- measuring_2 %>% 
  mutate(Plant = str_replace(Plant, " ", ""),
         date = my(1120)) %>% 
  filter(Plant != "") %>% 
  dplyr::select(plot_number,Plant, Height, Width.1, Width.2, Stem.Diameter, date)

# Growth data as of December 2021
measuring_growth_3 <- measuring_3 %>% 
  mutate(date = my(1221)) %>% 
  filter(Plant != "") %>% 
  dplyr::select(plot_number,Plant, Height, Width.1, Width.2, Stem.Diameter, date)

# Growth data grouped by species for all dates
growth <- rbind(planting_growth, measuring_growth, measuring_growth_2, measuring_growth_3) %>% 
  mutate(Height = as.numeric(Height),
         Width.1 = as.numeric(Width.1),
         Width.2 = as.numeric(Width.2),
         Stem.Diameter = as.numeric(Stem.Diameter)) %>% 
  group_by(Plant, date) %>% 
  summarise(mean_height = mean(Height, na.rm = TRUE),
            sd_height = sd(Height, na.rm = TRUE),
            mean_width_1 = mean(Width.1, na.rm = TRUE),
            sd_width_1 = sd(Width.1, na.rm = TRUE),
            mean_width_2 = mean(Width.2, na.rm = TRUE),
            sd_width_2 = sd(Width.2, na.rm = TRUE),
            mean_stem = mean(Stem.Diameter, na.rm = TRUE),
            sd_stem = sd(Stem.Diameter, na.rm = TRUE))

ggplot(growth, aes(date, mean_height)) + 
  geom_point()+
  geom_errorbar(aes(ymin = mean_height - sd_height, ymax = mean_height + sd_height), width = 0.2) +
  geom_line()+
  labs(y = "Stem Height (cm)") +
  facet_wrap(~Plant, nrow = 5, ncol = 2) +
  theme_classic()

ggplot(growth, aes(date, mean_width_1)) + 
  geom_point()+
  geom_errorbar(aes(ymin = mean_width_1 - sd_width_1, ymax = mean_width_1 + sd_width_1), width = 0.2) +
  geom_line()+
  labs(y = "Plant Width (cm)") +
  facet_wrap(~Plant, nrow = 5, ncol = 2) +
  theme_classic()

ggplot(growth, aes(date, mean_stem)) + 
  geom_point()+
  geom_errorbar(aes(ymin = mean_stem - sd_stem, ymax = mean_stem + sd_stem), width = 0.2) +
  geom_line()+
  labs(y = "Stem Diameter (cm)") +
  facet_wrap(~Plant, nrow = 5, ncol = 2) +
  theme_classic()
```

## Looking at survival without gopher kill 
  - unintuitably labelled gopher

```{r}
# Survival in May 2020
watering_gopher <- watering %>% 
  dplyr::select(plot_number, Watering.2.Date, Alive.1, Notes.1) %>% 
  rename("watering_date" = "Watering.2.Date",
         "watering_alive" = "Alive.1", 
         "watering_notes" = "Notes.1") 

# Growth & survival by July 2020 (gophers incl.)
measuring_gopher <- measuring %>% 
  dplyr::select(!Plant) %>% 
  rename("measuring_height" = "Height",
         "measuring_width_1" = "Width.1",
         "measuring_width_2" = "Width.2",
         "measuring_stem_diameter" = "Stem.Diameter",
         "measuring_date" = "Date.Measured",
         "measuring_notes" = "Notes")

# Growth & survival by November 2020 (gophers incl.)
measuring_gopher_2 <- measuring_2 %>% 
  dplyr::select(!Plant) %>%
  rename("measuring_2_height" = "Height",
         "measuring_2_width_1" = "Width.1",
         "measuring_2_width_2" = "Width.2",
         "measuring_2_stem_diameter" = "Stem.Diameter",
         "measuring_2_date" = "Date.Measured",
         "measuring_2_notes" = "Notes")

# Growth & survival by December 2021 (gophers incl.)
measuring_gopher_3 <- measuring_3 %>% 
  dplyr::select(!Plant) %>%
  rename("measuring_3_height" = "Height",
         "measuring_3_width_1" = "Width.1",
         "measuring_3_width_2" = "Width.2",
         "measuring_3_stem_diameter" = "Stem.Diameter",
         "measuring_3_date" = "Date.Measured",
         "measuring_3_notes" = "Notes")

# Joined table of growth/survival with all dates, gophers excluded
survival_gopher <- right_join(planting, watering_gopher, by = "plot_number") %>% 
  right_join(measuring_gopher, by = "plot_number") %>% 
  right_join(measuring_gopher_2, by = "plot_number") %>% 
  right_join(measuring_gopher_3, by = "plot_number") %>%  
  filter(watering_notes != "gopher", 
         watering_notes != "gopher activity", 
         watering_notes != "GOPHER", 
         watering_notes != "GOPHER ACTIVITY", 
         watering_notes != "5/15 np") %>% 
  filter(measuring_notes != "np", 
         measuring_notes != "np, g", 
         measuring_notes != "np, buried", 
         measuring_notes != "g.a.",
         measuring_notes != "dead, g.a.", 
         measuring_notes != "np, g.a.", 
         measuring_notes != "dead, g", 
         measuring_notes != "np, g (no coin catch#2)", 
         measuring_notes != "np,g",
         measuring_notes!= "herbivorized, g.a.") %>% 
  filter(measuring_2_notes != "NP", 
         measuring_2_notes != "MISSING", 
         measuring_2_notes != "NP ", 
         measuring_2_notes != "GOPHER", 
         measuring_2_notes != "NP? NO TAG", 
         measuring_2_notes != "MISSNG") %>%
  filter(measuring_3_notes != "NP")

# Survival data as of March 2020, excl. gopher
planting_survival_gopher <- survival_gopher %>% 
  dplyr::select(plot_number,Plant, Height, Date.Planted) %>% 
  mutate(Plant = str_replace_all(string = Plant, pattern = "(White + Pink)", replacement = "")) %>% 
  mutate(Plant = case_when(Plant == "ENCA (Pink)" ~ "ENCA",
                           Plant == "CEOL (Orange)" ~ "CEOL",
                           Plant == "HEWH (White)" ~ "HEWH",
                           Plant == "SAME (Orange + Pink)" ~ "SAME",
                           Plant == "SANI (Orange + Yellow)" ~ "SANI",
                           Plant == "RHOV (White + Pink)" ~ "RHOV",
                           Plant == "SAAP (White + Green)" ~ "SAAP",
                           Plant == "MALA (White + Yellow)" ~ "MALA",
                           Plant == "HEAR" ~ "HEAR",
                           Plant == "ADFA (Orange + Green)" ~ "ADFA",
                           Plant == "RHOV SAAP (White + Pink)" ~ "SAAP",
                           Plant == "ENCA CEOL (Pink)" ~ "CEOL", 
                           Plant == "HEWH (White) RHOV" ~ "RHOV",
                           Plant == "NO PLANT" ~ "No Plant")) %>% 
  filter(Plant != "No Plant", Height != "") %>% 
  mutate(date = my(0320),
         alive = 1) %>% 
  dplyr::select(plot_number,Plant, alive, date)

# Surival as of May 2020, excl. gopher
watering_survival_gopher <- survival_gopher %>%
  dplyr::select(plot_number,Plant, watering_alive, watering_date) %>% 
  mutate(Plant = case_when(Plant == "ENCA (Pink)" ~ "ENCA",
                           Plant == "CEOL (Orange)" ~ "CEOL",
                           Plant == "HEWH (White)" ~ "HEWH",
                           Plant == "SAME (Orange + Pink)" ~ "SAME",
                           Plant == "SANI (Orange + Yellow)" ~ "SANI",
                           Plant == "RHOV (White + Pink)" ~ "RHOV",
                           Plant == "SANI (Orange + Yellow) CEOL" ~ "CEOL",
                           Plant == "SAAP (White + Green)" ~ "SAAP",
                           Plant == "MALA (White + Yellow)" ~ "MALA",
                           Plant == "SANI  MALA" ~ "MALA",
                           Plant == "HEAR" ~ "HEAR",
                           Plant == "ADFA (Orange + Green)" ~ "ADFA",
                           Plant == "HEWH (White) ENCA" ~ "ENCA",
                           Plant == "ADFA" ~ "ADFA",
                           Plant == "SANI" ~ "SANI",
                           Plant == "SAME" ~ "SAME",
                           Plant == "SANI " ~ "SANI",
                           Plant == "" ~"No plant")) %>% 
  filter(Plant != "No plant") %>% 
  mutate(alive = case_when(watering_alive == "y" ~ 1,
                           watering_alive == "Y" ~ 1,
                           watering_alive == "n" ~ 0,
                           watering_alive == "np" ~ 0,
                           watering_alive == "" ~ 0,
                           watering_alive == "N" ~ 0,
                           watering_alive == "NP" ~ 0),
         date = my(0520)) %>% 
  dplyr::select(plot_number,Plant, alive, date)

# Survival as of July 2020, excl. gopher
measuring_survival_gopher <- survival_gopher %>% 
  dplyr::select(plot_number,Plant, measuring_height, measuring_date) %>% 
  mutate(Plant = case_when(Plant == "ENCA (Pink)" ~ "ENCA",
                           Plant == "CEOL (Orange)" ~ "CEOL",
                           Plant == "HEWH (White)" ~ "HEWH",
                           Plant == "SAME (Orange + Pink)" ~ "SAME",
                           Plant == "SANI (Orange + Yellow)" ~ "SANI", 
                           Plant == "RHOV (White + Pink)" ~ "RHOV",
                           Plant == "SAAP (White + Green)" ~ "SAAP",
                           Plant == "MALA (White + Yellow)" ~ "MALA",
                           Plant == "ADFA (Orange + Green)" ~ "ADFA",
                           Plant == "HEAR" ~ "HEAR",
                           Plant == "ENCA CEOL (Pink)" ~ "CEOL",
                           Plant == "NO PLANT" ~ "No Plant",
                           Plant == "HEWH (White) RHOV" ~ "RHOV",
                           Plant == "HEWH" ~ "HEWH"),
         alive = case_when(measuring_height > 0 ~ 1, 
                           TRUE ~0),
         date = my(0720)) %>% 
  filter(Plant != "No Plant") %>% 
  dplyr::select(plot_number,Plant, alive, date)

# Survival as of November 2020
measuring_survival_gopher_2 <- survival_gopher %>% 
  dplyr::select(plot_number,Plant, measuring_2_height, measuring_2_date) %>% 
  mutate(Plant = str_replace(Plant, " ", ""),
         Plant = case_when(Plant == "ENCA(Pink)" ~ "ENCA",
                           Plant == "CEOL(Orange)" ~ "CEOL",
                           Plant == "HEWH(White)" ~ "HEWH",
                           Plant == "SAME(Orange + Pink)" ~ "SAME",
                           Plant == "SANI(Orange + Yellow)" ~ "SANI", 
                           Plant == "RHOV(White + Pink)" ~ "RHOV",
                           Plant == "SAAP(White + Green)" ~ "SAAP",
                           Plant == "MALA(White + Yellow)" ~ "MALA",
                           Plant == "ADFA(Orange + Green)" ~ "ADFA",
                           Plant == "HEAR" ~ "HEAR",
                           Plant == "ENCACEOL (Pink)" ~ "CEOL",
                           Plant == "NOPLANT" ~ "No Plant",
                           Plant == "HEWH(White) RHOV" ~ "RHOV",
                           Plant == "HEWH" ~ "HEWH",
                           TRUE ~ Plant),
         alive = case_when(measuring_2_height > 0 ~ 1,
                           TRUE ~ 0),
         date = my(1120)) %>% 
  filter(Plant != "") %>% 
  dplyr::select(plot_number,Plant, alive, date)

# Survival as of December 2021, excl. gopher
measuring_survival_gopher_3 <- survival_gopher %>% 
  dplyr::select(plot_number,Plant, measuring_3_height, measuring_3_date) %>% 
  mutate(Plant = case_when(Plant == "ENCA (Pink)" ~ "ENCA",
                           Plant == "CEOL (Orange)" ~ "CEOL",
                           Plant == "HEWH (White)" ~ "HEWH",
                           Plant == "SAME (Orange + Pink)" ~ "SAME",
                           Plant == "SANI (Orange + Yellow)" ~ "SANI", 
                           Plant == "RHOV (White + Pink)" ~ "RHOV",
                           Plant == "SAAP (White + Green)" ~ "SAAP",
                           Plant == "MALA (White + Yellow)" ~ "MALA",
                           Plant == "ADFA (Orange + Green)" ~ "ADFA",
                           Plant == "HEAR" ~ "HEAR",
                           Plant == "ENCA CEOL (Pink)" ~ "CEOL",
                           Plant == "NO PLANT" ~ "No Plant",
                           Plant == "HEWH (White) RHOV" ~ "RHOV",
                           Plant == "HEWH" ~ "HEWH"),
         alive = case_when(measuring_3_height > 0 ~ 1, 
                           TRUE ~ 0),
        date = my(1221)) %>% 
  filter(Plant != "") %>% 
  dplyr::select(plot_number,Plant, alive, date)

# Survival grouped by species with all dates, excl. gopher, with pretty field names
survival_gopher_clean <- rbind(planting_survival_gopher,
                  watering_survival_gopher,
                  measuring_survival_gopher, 
                  measuring_survival_gopher_2, 
                  measuring_survival_gopher_3) %>% 
  group_by(Plant, date) %>% 
  summarise(alive = sum(alive, na.rm = TRUE)) %>% 
  ungroup() %>% 
  filter(Plant != "No Plant") %>% 
  mutate(alive_percent = case_when(Plant == "ADFA" ~ alive/118 * 100,
                                   Plant == "CEOL" ~ alive/97 * 100,
                                   Plant == "ENCA" ~ alive/83 * 100,
                                   Plant == "HEAR" ~ alive/61 * 100,
                                   Plant == "HEWH" ~ alive/80 * 100,
                                   Plant == "MALA" ~ alive/43 * 100,
                                   Plant == "RHOV" ~ alive/75 * 100,
                                   Plant == "SAAP" ~ alive/45 * 100,
                                   Plant == "SAME" ~ alive/48 * 100, 
                                   Plant == "SANI" ~ alive/62 * 100),
         Plant = case_when(Plant == "ADFA" ~ "Adenostoma fasciculatum",
                                   Plant == "CEOL" ~ "Ceanothus oliganthus",
                                   Plant == "ENCA" ~ "Encelia californica",
                                   Plant == "HEAR" ~ "Heteromeles arbutifolia",
                                   Plant == "HEWH" ~ "Hesperoyucca whipplei",
                                   Plant == "MALA" ~ "Malosma laurina",
                                   Plant == "RHOV" ~ "Rhus ovata",
                                   Plant == "SAAP" ~ "Salvia apiana",
                                   Plant == "SAME" ~ "Salvia mellifera", 
                                   Plant == "SANI" ~ "Sambucus nigra"))

# Survival of all species combined with all dates, excl. gopher, with pretty field names
survival_gopher_total <- survival_gopher_clean %>% 
  group_by(date) %>% 
  summarise(alive = sum(alive))

ggplot(survival_gopher_clean, aes(date, alive_percent)) +
  geom_point() +
  geom_line () +
  facet_wrap(~Plant, nrow = 5, ncol = 2) +
  labs(y = "Percent Alive") +
  theme_classic()

ggplot(survival, aes(date, alive)) +
  geom_point() +
  geom_line () +
  facet_wrap(~Plant, nrow = 5, ncol = 2) +
  theme_classic()

ggplot(survival_total, aes(date, alive)) +
  geom_point() +
  geom_line() +
  labs(y = "Number plants alive") +
  theme_classic()
```



## Reading in gps points and topgraphy data


```{r}
plots <- st_read(here("data", "plot_gps_points.shp")) %>% 
  rename("plot_number" = "plt_nmb")
elevation <- raster(here("data", "elevation.tif"))
aspect <- raster(here("data", "aspect.tif"))
aspect <- cos((aspect * pi/180) - (225 * pi/180))
slope <- raster(here("data", "slope.tif"))
solar_radiation <- brick(here("data", "sol_rad.tif"))
diurnal_heat <- raster(here("data", "diurnal_heat.tif"))
heat_load <- raster(here("data", "heat_load_index.tif"))
ruggedness_vector <- raster(here("data", "ruggedness_vector.tif"))
sol_rad_aspect <- raster(here("data", "sol_rad_aspect.tif"))
terrain_ruggedness <- raster(here("data", "terrain_ruggedness.tif"))
terrain_texture <- raster(here("data", "terrain_texture.tif"))
topographic_position <- raster(here("data", "topographic_position.tif"))

```


## Extracting topographic data to plot points

```{r}
plots_topography <- plots %>% 
  mutate(elevation = raster::extract(elevation, plots),
         aspect = raster::extract(aspect, plots),
         slope = raster::extract(slope, plots),
         summer_solar_radiation = raster::extract(solar_radiation[[3]], plots),
         spring_solar_radiation = raster::extract(solar_radiation[[2]], plots),
         winter_solar_radiation = raster::extract(solar_radiation[[1]], plots),
         diurnal_heat = raster::extract(diurnal_heat, plots),
         heat_load = raster::extract(heat_load, plots),
         sol_rad_aspect = raster::extract(sol_rad_aspect, plots),
         terrain_ruggedness = raster::extract(terrain_ruggedness, plots),
         terrain_texture = raster::extract(terrain_texture, plots),
         topographic_position = raster::extract(topographic_position, plots)) 
```

## Making shapefiles of survival data for mapping

```{r}
planting_survival_spatial <- right_join(planting_survival, plots_topography, by = "plot_number") %>% 
  drop_na(Plant)
may_survival_spatial <- right_join(watering_survival, plots_topography, by = "plot_number") %>% 
  drop_na(Plant)
july_survival_spatial <- right_join(measuring_survival, plots_topography, by = "plot_number") %>% 
  drop_na(Plant)
november_survival_spatial <- right_join(measuring_survival_2, plots_topography, by = "plot_number") %>% 
  drop_na(Plant)
december_survival_spatial <- right_join(measuring_survival_3, plots_topography, by = "plot_number") %>% 
  drop_na(Plant)
```


